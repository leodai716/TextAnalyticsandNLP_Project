<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Scraping Tweets, New Lessons Learned | Text Analitics and Natural Language Processing appliction in Brexit and Finance</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Scraping Tweets, New Lessons Learned" />
<meta name="author" content="Mars Leung" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A Twitter Illiterate’s Attempt at Twitter Mining Hello, I am Mars Leung. In this project where we attempt to read market sentiment online regarding Brexit to predict the movement of the British Pound’s strength, I’m responsible for designing the code for its very first stage - Twitter-mining." />
<meta property="og:description" content="A Twitter Illiterate’s Attempt at Twitter Mining Hello, I am Mars Leung. In this project where we attempt to read market sentiment online regarding Brexit to predict the movement of the British Pound’s strength, I’m responsible for designing the code for its very first stage - Twitter-mining." />
<link rel="canonical" href="http://localhost:4000/myghpage/NLPproject/nlp/data%20scraping/2019/10/19/Tweepy-blog-post.html" />
<meta property="og:url" content="http://localhost:4000/myghpage/NLPproject/nlp/data%20scraping/2019/10/19/Tweepy-blog-post.html" />
<meta property="og:site_name" content="Text Analitics and Natural Language Processing appliction in Brexit and Finance" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-19T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Scraping Tweets, New Lessons Learned","dateModified":"2019-10-19T00:00:00+08:00","datePublished":"2019-10-19T00:00:00+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/myghpage/NLPproject/nlp/data%20scraping/2019/10/19/Tweepy-blog-post.html"},"url":"http://localhost:4000/myghpage/NLPproject/nlp/data%20scraping/2019/10/19/Tweepy-blog-post.html","author":{"@type":"Person","name":"Mars Leung"},"description":"A Twitter Illiterate’s Attempt at Twitter Mining Hello, I am Mars Leung. In this project where we attempt to read market sentiment online regarding Brexit to predict the movement of the British Pound’s strength, I’m responsible for designing the code for its very first stage - Twitter-mining.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/myghpage/NLPproject/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/myghpage/NLPproject/feed.xml" title="Text Analitics and Natural Language Processing appliction in Brexit and Finance" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/myghpage/NLPproject/">Text Analitics and Natural Language Processing appliction in Brexit and Finance</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/myghpage/NLPproject/about/">About</a><a class="page-link" href="/myghpage/NLPproject/projects/">Projects</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Scraping Tweets, New Lessons Learned</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-10-19T00:00:00+08:00" itemprop="datePublished">Oct 19, 2019
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Mars Leung</span></span></p>
    <p class="post-meta"><span>NLPData Scraping</span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="a-twitter-illiterates-attempt-at-twitter-mining">A Twitter Illiterate’s Attempt at Twitter Mining</h1>
<p>Hello, I am Mars Leung. In this project where we attempt to read market sentiment online regarding Brexit to predict the movement of the British Pound’s strength, I’m responsible for designing the code for its very first stage - Twitter-mining.</p>

<p>There’s only one problem - I don’t use Twitter - in fact, none of us does. So in this post,  not only will I walk you through the code, I’ll also show you struggle and journey I went through.</p>
<h2 id="objectives">Objectives</h2>
<p>To facilitate sentimental analysis through text analytics and natural language processing in the later stages of our project, this sub-project aims to collect raw text data.</p>

<p>The mission is simple: with a given keyword, the programme should fetch every newly-made Tweet that contains the keyword from Twitter, and dump all of them into a file, all in real time.</p>

<p>Of course, later we’ll see, my rather simplistic view of how Twitter works would soon be crushed by the mundanity and agony of the reality <em>(I’m saying that with a slight hyperbole)</em>.</p>
<h2 id="applying-for-access-to-the-twitter-api">Applying for Access to the Twitter API</h2>
<p>I am using the Tweepy package to perform Twitter-scraping, and that requires access to the Twitter API, for which I needed to apply beforehand. Well actually by itself it’s not a hard task. It’s just that when I saw this application form, I was reminded of <a href="https://www.youtube.com/results?search_query=youtube%20is%20broken">the red tape of another online platform frequently criticized by their own online creators</a>.</p>

<p>But it turned out that the approval from Twitter was almost instantaneous, for which I am so grateful, as I can’t imagine the whole project being dragged behind waiting for some Twitter employee to manually review and accept my application. Looking back, it’s kinda funny how I over-thought things.
<img src="https://github.com/leodai716/TextAnalyticsandNLP_Project/blob/master/_posts/Tweepy%20blog%20post%20images/1.%20API%20application.jpg?raw=true" alt="enter image description here" />
So after this tiny speed bump, I went full-on and built a first prototype.</p>
<h2 id="understanding-tweeting---the-hard-way">Understanding Tweeting - the Hard Way</h2>
<p>I have coded long enough to know that it’s a miracle when a first prototype is working perfectly, if at all. The programme, which in theory could run indefinitely, ran into an error and stopped after about 5 seconds <em>(uplifting, I know)</em>.</p>

<p>Looking at the output, there are two problems:</p>
<ol>
  <li>The error that broke the programme was <code class="highlighter-rouge">UnicodeEncodeError: 'cp950' codec can't encode character '\U0001f525' in position 60: illegal multibyte sequence</code>, whatever that meant.</li>
  <li>Many tweets output were cut off by an ellipsis (…).</li>
</ol>

<p><img src="https://github.com/leodai716/TextAnalyticsandNLP_Project/blob/master/_posts/Tweepy%20blog%20post%20images/2.%20bug%20.jpg?raw=true" alt="enter image description here" />
So, what happened?</p>

<h3 id="the-emoji-bug">The Emoji Bug</h3>
<p>It turned out Python ran into problem using ordinary <code class="highlighter-rouge">f.write(string)</code> method when it attempts to output special characters, which are abundant on Twitter in the form of emojis. It’s not that Python cannot process emojis  at all - the console can print them after simple string operations with no problem - it’s outputting them into an external file that’s problematic.
<img src="https://github.com/leodai716/TextAnalyticsandNLP_Project/blob/master/_posts/Tweepy%20blog%20post%20images/3.%20Console.jpg?raw=true" alt="enter image description here" />
This problem is new to me, because as a student who learns coding mostly for panel-data analyses, I had had no reason dealing with emojis in my previous projects.</p>

<p>I soon learnt that I could encode the output file in utf-8 with <code class="highlighter-rouge">open(outputFile, 'a', encoding = "utf-8")</code>, and somehow it just worked, just like magic. The code was able to run indefinitely at last, and the emojis went straight to the output file with no error. Boom - problem solved! With a grin in my face, I moved to problem 2…</p>
<h3 id="140---the-mystery-of-the-twitter-phantom">140 - the Mystery of the Twitter Phantom</h3>
<p>Okay so what the heck was going on with the ellipses? I had no idea, so I looked into the output for clues. Apparently, all cut-off Tweets were at the 140-character mark.</p>

<p>140 characters - a clue. Does that ring a bell with you? It certainly did with me, but I just couldn’t figure it out what it was…</p>

<p>It took me like an hour staring at the ceiling of my room, but it eventually hit - 140 characters - the Tweet character limit! Users could not tweet more than 140 characters. I vaguely remembered the buzz that was going on when <a href="https://techcrunch.com/2018/10/30/twitters-doubling-of-character-count-from-140-to-280-had-little-impact-on-length-of-tweets/">Twitter officially lifted this rule last year</a> - the character limit now is 280 characters, so why was ye-olde 140 popping up in my code?</p>
<h3 id="the-unmasking-of-erik">The Unmasking of Erik</h3>
<p>Tweets existed in Twitter in the form of objects of class Tweet. And when Twitter lifted the character limit from 140 to 280, instead of simply modifying the behaviour of the existing Tweet object, it creaded a new object class: Extended Tweet. Some additional attributes in this new class allows the Tweet texts to exceed 140 characters.</p>

<p>Simply saying, what my code was doing was reading all Tweets as if they were of the original Tweet class, so they lost the attribute from the Extended Tweet class and got cut off at the 140 mark.</p>

<p>And… it’s not just that. Retweets also exist, and they are also of a separate object class themselves. So my code had to account for a Tweet that might or might not be extended, and might or might not be retweeted, any of which has a separate object-class structure.</p>

<p>I could pass the blame to the fact that I don’t use Twitter, so I had no idea what a Retweet was or how the character cap was set. But honestly, and it’s almost shameful to admit that, I should have read the <a href="https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/intro-to-tweet-json#extendedtweet">documentations</a> before diving right into the coding. I guess that’s the biggest takeaway here. :)</p>

<h1 id="ending-words">Ending Words</h1>
<p>The code at the end ran perfectly, and we are using it to stream Tweets in real time. After this we will move on to the sentimental-analysis stage, and start the main course.</p>

<p><em>And by the way do you know that on average 7 Tweets are made per second about Brexit? Crazy right?</em>
<img src="https://github.com/leodai716/TextAnalyticsandNLP_Project/blob/master/_posts/Tweepy%20blog%20post%20images/4.%20Output.jpg?raw=true" alt="enter image description here" />
Overall it was quite a journey. I learnt to use a completely unfamiliar package, the importance of reading documentations, and actually built something useful. I look forward to what will be coming in the next few weeks, and I cannot be more excited.</p>

  </div><a class="u-url" href="/myghpage/NLPproject/nlp/data%20scraping/2019/10/19/Tweepy-blog-post.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/myghpage/NLPproject/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Text Analitics and Natural Language Processing appliction in Brexit and Finance</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            <!--Text Analitics and Natural Language Processing appliction in Brexit and Finance --></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
